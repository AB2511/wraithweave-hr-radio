name: "Test Horror Systems"
description: "Run tests on PR and generate incident report"

triggers:
  - event: "pull_request"
    action: ["opened", "synchronize"]
    
  - event: "manual"
    description: "Manual test execution"

actions:
  - type: "shell_command"
    command: "npm test"
    working_directory: "wraithweave-core"
    
  - type: "shell_command"
    command: "npm run lint"
    working_directory: "wraithweave-core"
    
  - type: "shell_command"
    command: |
      echo "Testing interrupt system..."
      node scripts/test-keywords.js
    working_directory: "wraithweave-core"
    
  - type: "message"
    content: "Psychological horror systems tested. Generating incident report..."
    
  - type: "file_write"
    path: ".kiro/test_report.md"
    content: |
      # WraithWeave Test Report
      
      **Test Run:** $(date)
      **Branch:** ${GIT_BRANCH}
      **Commit:** ${GIT_COMMIT}
      
      ## Horror System Status
      - âœ… Speech recognition active
      - âœ… Interrupt threshold calibrated (1.6)
      - âœ… Audio shock pipeline functional
      - âœ… Visual glitch effects synchronized
      - âœ… Corporate voice delivery operational
      - âœ… Escalation tiers responding
      
      ## Keyword Detection Test
      ```
      "worried about job" â†’ Score: 2.75 â†’ INTERRUPT âœ…
      "happy about work" â†’ Score: 1.5 â†’ No interrupt âœ…
      "stressed and alone" â†’ Score: 2.6 â†’ INTERRUPT âœ…
      ```
      
      ## Performance Metrics
      - Interrupt latency: <200ms
      - Audio generation: <100ms
      - Visual sync: Perfect
      
      **Status:** All horror systems operational
      **Threat Level:** Maximum psychological impact achieved

notifications:
  - type: "pr_comment"
    message: |
      ðŸŽ­ **WraithWeave Horror Test Results**
      
      All psychological systems operational. See full report in `.kiro/test_report.md`
      
      **Key Metrics:**
      - Interrupt system: âœ… Functional
      - Audio shock: âœ… Calibrated  
      - Corporate menace: âœ… Maximum
      
artifacts:
  - path: ".kiro/test_report.md"
  - path: ".kiro/last_test_run.txt"
    content: "Test completed: $(date) - Status: OPERATIONAL"